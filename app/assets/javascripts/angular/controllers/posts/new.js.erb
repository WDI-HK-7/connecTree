app.controller('PostsNewCtrl', ['$scope', '$http', '$location', '$routeParams', 'Upload', function($scope, $http, $location, $routeParams, Upload){

  $scope.post = {};
  $scope.form = {};
  $scope.picture = {};
 

  var url = "<%= ENV['URL'] %>" || "http://localhost:3000/";

  $http.get(url + 'current_user.json').success(function(response){
    console.log(response);
    $scope.user = response 
    $location.path('/new_posts');
    $http.get(url + 'users/'+response.id+'/posts.json').success(function(response){
      console.log(response);
      $scope.posts = response;
    });
  });

  $http.get(url + 'posts').success(function(response){
    console.log(response);
    $scope.posts = response;
  });
  
  $scope.picInfo = function(id){
    console.log('working');
    $location.path('/posts/' + id);
  };


  $scope.form.create = function(){
    var data = {
      'post[title]'  : $scope.post.title,
      'post[caption]': $scope.post.caption
    };
   
    Upload.upload({
      url: url + 'posts',
      method:'POST',
      fields: data,
      file: $scope.picture.files[0],
      fileFormDataName: 'post[picture]',
    }).success(function(response){
      console.log(response);
    });

     
  };
    

}]);
 
  
